# Use a base image with a recent version of Ubuntu
FROM ubuntu:22.04

# Set environment variables for Nextflow
ENV NEXTFLOW_HOME=/usr/local/nextflow
ENV PATH="$NEXTFLOW_HOME:$PATH"

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    openjdk-17-jre \
    git \
    graphviz \
    less \
    procps \
    unzip \
    wget && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Install Nextflow
RUN wget -qO- https://get.nextflow.io | bash && \
    mv nextflow ${NEXTFLOW_HOME} && \
    chmod +x ${NEXTFLOW_HOME}

# Set the working directory for the pipeline
WORKDIR /opt/pipeline

# Copy pipeline files into the container
COPY ./configs /opt/pipeline/configs
COPY ./lib /opt/pipeline/lib
COPY ./modules /opt/pipeline/modules
COPY ./assets /opt/pipeline/assets
COPY ./src /opt/pipeline/src

# The main pipeline script
COPY ./theworks.nf /opt/pipeline/theworks.nf

CMD ["nextflow", "run", "theworks.nf"]
